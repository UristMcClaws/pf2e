<form class="army-sheet" autocomplete="off">

    {{!-- ============== --}}
    {{!--    SIDEBAR     --}}
    {{!-- ============== --}}
    <aside class="army-sidebar">
        {{!-- Portrait --}}
        <section class="image-container">
            <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}"/>
            <a class="hover-icon" data-feat="show-image"><i class="fas fa-image fa-fw"></i></a>
        </section>

        {{!-- AC --}}
        <section class="sidebar-section">
            <div class="section-head">
                <i class="fa-solid fa-fw fa-shield-alt"></i>
                <h4>{{localize "PF2E.ArmorClassLabel"}}</h4>
                <input type="number" data-property="system.attributes.ac.value" value="{{add data.attributes.ac.value data.gear.armor.magic.bonus}}" data-dtype="Number"/>
            </div>
            <div class="buttons">
                <button title="{{data.gear.armor.magic.name}}" class="armor pips" type="button">
                    {{#times 3}}
                        <i class="{{#if (gt @root.data.gear.armor.magic.bonus this)}}far fa-shield filled{{else}}fal fa-shield empty{{/if}}"></i>
                    {{/times}}
                </button>
                <label for="data.gear.armor.magic.name"><span class="plus">+</span>{{data.gear.armor.magic.bonus}}</label>
            </div>
            <input type="text" data-dtype="String" data-property="system.attributes.ac.details" value="{{data.attributes.ac.details}}" class="armor-details" placeholder="{{localize "PF2E.NPC.ArmorExtraInfoLabelPlaceholder"}}" />
        </section>

        {{!-- HP --}}
        <section class="sidebar-section">
            <div class="section-head">
                <i class="fa-solid fa-fw fa-heart"></i>
                <h4>{{localize "PF2E.HitPointsShortLabel"}}</h4>
                    <input type="number" data-property="system.attributes.hp.value" value="{{data.attributes.hp.value}}" data-dtype="Number"/>
                    <span class="slash">/</span>
                    <input type="number" data-property="system.attributes.hp.max" value="{{data.attributes.hp.max}}" data-dtype="Number"/>
            </div>
            <div class="buttons">
                <button title="{{data.gear.potions.unlocked}} {{data.gear.potions.name}}(s)" class="potion pips" type="button">
                    {{#times 3}}
                        <i class="{{#if (gt @root.data.gear.potions.unlocked this)}}far fa-flask-round-potion filled{{else}}fal fa-flask-round-potion empty{{/if}}"></i>
                    {{/times}}
                </button>
                {{#if (eq @root.data.gear.potions.unlocked 0)}}
                    <button title="No Potions ☹" class="disabled" type="button"><i class="fal fa-champagne-glasses"></i>
                {{else if (eq @root.document.hitPoints.value @root.document.hitPoints.max)}}
                    <button title="HP is already max ☺" class="disabled" type="button"><i class="fal fa-champagne-glasses"></i>
                {{else}}
                    <button title="Use Potion (+1 HP)" class="usepotion" type="button"><i class="fas fa-champagne-glasses"></i>
                {{/if}}
                </button>
                <label {{#if (lt data.attributes.hp.value data.attributes.hp.rout)}}class="routed" {{/if}}>Rout: <input type="number" data-property="system.attributes.hp.rout" value="{{data.attributes.hp.rout}}" data-dtype="Number"/></label>
            </div>
            <input type="text" data-property="system.attributes.hp.details" value="{{data.attributes.hp.details}}" title="{{data.attributes.hp.details}}" data-dtype="String" placeholder="{{localize "PF2E.NPC.HPExtraInfoLabelPlaceholder"}}"/>
        </section>

        {{!-- Attributes --}}
        <section class="sidebar-section">
            <div class="section-head">
                <h4>Attributes</h4>
            </div>
            <div>
                <label for="system.attributes.scouting.bonus">{{localize "PF2E.Actor.Army.Attrscouting"}}</label>
                <section class="roll">
                    <a data-attribute="scouting" class="rollable roll-icon"><i class="fas fa-dice-d20"></i></a>
                    <span class="plus">+</span>
                    <input class="roll-bonus" type="number" data-property="system.attributes.scouting.bonus" value="{{data.attributes.scouting.bonus}}" data-dtype="Number"/>
                </section>
            </div>
            <div>
                <label for="system.attributes.morale.bonus">{{localize "PF2E.Actor.Army.Attrmorale"}}</label>
                <section class="roll">
                    <a data-attribute="morale" class="rollable roll-icon"><i class="fas fa-dice-d20"></i></a>
                    <span class="plus">+</span>
                    <input class="roll-bonus" type="number" data-property="system.attributes.morale.bonus" value="{{data.attributes.morale.bonus}}" data-dtype="Number"/>
                </section>
            </div>
            <div>
                <label for="system.attributes.maneuver.bonus">{{localize "PF2E.Actor.Army.Attrmaneuver"}}</label>
                <section class="roll">
                    <a data-attribute="maneuver" class="rollable roll-icon"><i class="fas fa-dice-d20"></i></a>
                    <span class="plus">+</span>
                    <input class="roll-bonus" type="number" data-property="system.attributes.maneuver.bonus" value="{{data.attributes.maneuver.bonus}}" data-dtype="Number"/>
                </section>
            </div>
        </section>

        {{!-- Economy --}}
        <section class="sidebar-section">
            <div class="section-head">
                <h4>Economy</h4>
            </div>
            <div>
                <label for="data.details.consumption">Consumption:</label>
                <input type="number" data-property="system.details.consumption" value="{{data.details.consumption}}" data-dtype="Number"/>
            </div>
            <div>
                <label for="data.details.recruitmentDC">Recruitment DC:</label>
                <input type="number" data-property="system.details.recruitmentDC" value="{{data.details.recruitmentDC}}" data-dtype="Number"/>
            </div>
        </section>
    </aside>

    <section class="army-body">

        {{!-- ============== --}}
        {{!--     Header     --}}
        {{!-- ============== --}}
        <header class="army-sheet-header">
            {{!-- NAME --}}
            <div class="name flex">
                <input class="name-value" name="name" type="text" value="{{actor.name}}" placeholder="Army Name" spellcheck="false" />
                <label class="level-label">Army <input class="level" name="system.details.level.value" type="number" value="{{data.details.level.value}}"/></label>
            </div>
            {{!-- TRAITS --}}
            <div>
                <select class="rarity-select trait {{data.traits.rarity}}" name="system.traits.rarity">
                    {{#select data.traits.rarity}}
                        <option value="common">Common</option>
                        <option value="uncommon">Uncommon</option>
                        <option value="rare">Rare</option>
                        <option value="unique">Unique</option>
                    {{/select}}
                </select>
                <select class="alignment-select trait {{data.details.alignment}}" name="system.details.alignment">
                    {{#select data.details.alignment}}
                        <option>LG</option>
                        <option>NG</option>
                        <option>CG</option>
                        <option>LN</option>
                        <option>N</option>
                        <option>CN</option>
                        <option>LE</option>
                        <option>NE</option>
                        <option>CE</option>
                    {{/select}}
                </select>
                <select name="system.traits.type" class="armytype-select trait">
                    {{#select data.traits.type}}
                        <option title="{{localize "PF2E.Actor.Army.ArmyTypeDescriptionInfantry"}}" value="infantry">{{localize "PF2E.Actor.Army.ArmyTypeInfantry"}}</option>
                        <option title="{{localize "PF2E.Actor.Army.ArmyTypeDescriptionCavalry"}}" value="cavalry">{{localize "PF2E.Actor.Army.ArmyTypeCavalry"}}</option>
                        <option title="{{localize "PF2E.Actor.Army.ArmyTypeDescriptionSkirmisher"}}" value="skirmisher">{{localize "PF2E.Actor.Army.ArmyTypeSkirmisher"}}</option>
                        <option title="{{localize "PF2E.Actor.Army.ArmyTypeDescriptionSiege"}}" value="siege">{{localize "PF2E.Actor.Army.ArmyTypeSiege"}}</option>
                    {{/select}}
                </select>
            </div>
            {{!-- BLURB --}}
            <input name="system.details.blurb" type="text" value="{{data.details.blurb}}" />
        </header>

        {{!-- ============== --}}
        {{!--      Body      --}}
        {{!-- ============== --}}
        <section class="sheet-body">

                {{!-- ============== --}}
                {{!--     Strikes    --}}
                {{!-- ============== --}}
                <section class="weapons">
                    <fieldset class="weapons">
                    <legend><i class="fa-light fa-swords"></i>&nbsp;Strikes</legend>
                        <div class="strike {{#if data.gear.melee.unlocked}}unlocked{{else}}locked{{/if}}">
                            <section class="roll strike" title="{{localize "PF2E.Actor.Army.Strikemelee"}} ( +{{data.gear.melee.bonus}} proficiency, +{{data.gear.melee.magic.bonus}} potency )">
                                <a data-strike="melee" class="rollable melee"><i class="fas fa-dice-d20"></i></a>
                                <span class="plus">+</span>
                                <input class="roll-bonus" type="number" data-property="system.gear.melee.bonus" value="{{add data.gear.melee.bonus data.gear.melee.magic.bonus}}" data-dtype="Number"/>              
                            </section>                        
                            <input class="melee name" type="text" data-property="system.gear.melee.name" value="{{data.gear.melee.name}}" placeholder="{{localize "PF2E.Actor.Army.Strikemelee"}}" />
                            {{#if data.gear.melee.unlocked}}
                                <button class="melee unlock" type="button"><i class="fas fa-lock-open empty" title="Weapon is available"></i></button>
                            {{else}}
                                <button class="melee unlock" type="button"><i class="fas fa-lock filled" title="Weapon is not available"></i></button>
                            {{/if}}
                        </div>
                        <div class="strike {{#if data.gear.ranged.unlocked}}unlocked{{else}}locked{{/if}}">
                            <section class="roll strike" title="{{localize "PF2E.Actor.Army.Strikeranged"}} ( +{{data.gear.ranged.bonus}} proficiency, +{{data.gear.ranged.magic.bonus}} potency )">
                                <a data-strike="ranged" class="rollable ranged"><i class="fas fa-dice-d20"></i></a>
                                <span class="plus">+</span>
                                <input class="roll-bonus" type="number" data-property="system.gear.ranged.bonus" value="{{add data.gear.ranged.bonus data.gear.ranged.magic.bonus}}" data-dtype="Number"/>              
                            </section>
                            <input class="ranged name" type="text" data-property="system.gear.ranged.name" value="{{data.gear.ranged.name}}" placeholder="{{localize "PF2E.Actor.Army.Strikeranged"}}" />
                            <button title="Ammunition: {{data.gear.ammunition.value}}" class="ammunition pips" type="button">
                                {{#times data.gear.ammunition.max}}
                                <i class="{{#if (gt @root.data.gear.ammunition.value this)}}far fa-dagger filled{{else}}fal fa-dagger empty{{/if}}"></i>
                                {{/times}}
                            </button>
                            {{#if data.gear.ranged.unlocked}}
                                <button class="ranged unlock" type="button"><i class="fas fa-lock-open empty" title="Weapon is available"></i></button>
                            {{else}}
                                <button class="ranged unlock" type="button"><i class="fas fa-lock filled" title="Weapon is not available"></i></button>
                            {{/if}}
                        </div>
                    </fieldset>

                    <fieldset class="upgrades">
                    <legend><i class="fa-light fa-sparkle"></i>&nbsp;Upgrades</legend>
                        <div class="strike rank {{#if data.gear.melee.unlocked}}unlocked{{else}}locked{{/if}}">
                            <button title="{{data.gear.melee.magic.rank}}" class="melee pips" type="button">
                                {{#times 3}}
                                <i class="{{#if (gt @root.data.gear.melee.magic.bonus this)}}far fa-sword filled{{else}}fal fa-sword empty{{/if}}"></i>
                                {{/times}}
                            </button>
                            <button class="info" data-info="melee" type="button">
                                <i class="far fa-question-circle"></i>
                            </button>
                        </div>
                        <div class="strike rank {{#if data.gear.ranged.unlocked}}unlocked{{else}}locked{{/if}}">
                            <button title="{{data.gear.ranged.magic.rank}}" class="ranged pips" type="button">
                                {{#times 3}}
                                <i class="{{#if (gt @root.data.gear.ranged.magic.bonus this)}}far fa-bow-arrow filled{{else}}fal fa-bow-arrow empty{{/if}}"></i>
                                {{/times}}
                            </button>
                            <button class="info" data-info="ranged" type="button">
                                <i class="far fa-question-circle"></i>
                            </button>
                        </div>
                    </fieldset>
                </section>

                {{!-- ============== --}}
                {{!--     Actions    --}}
                {{!-- ============== --}}
                {{#if document.itemTypes.action}}
                <fieldset>
                    <legend class="compendium-items"><i class="fa-light fa-diamond"></i>&nbsp;Actions</legend>
                        <ol class="item-list">
                            {{#each document.itemTypes.action as |action|}}
                                <li class="item" data-item-id="{{action._id}}">
                                    <a class="item-icon item-chat">
                                        <i class="imgicon fa-solid fa-fw fa-comment-alt"></i>
                                        <img class="item-icon" src="{{action.img}}" alt="{{action.name}}" />
                                    </a>
                                    <label class="item-name">
                                        <a>{{action.name}}</a>
                                    </label>                                    </label>
                                        {{#if action.system.frequency}}
                                            <section class="item-frequency">
                                                <input type="number" value="{{action.system.frequency.value}}" data-item-id="{{action._id}}" data-item-property="system.frequency.value"/>
                                                <span>
                                                    /
                                                    {{action.system.frequency.max}}
                                                    {{localize "PF2E.Frequency.per"}}
                                                    {{localize (lookup @root.frequencies action.system.frequency.per)}}
                                                </span>
                                            </section>
                                        {{/if}}
                                    <div class="item-controls">
                                            <a class="item-chat chat" title="{{localize "PF2E.NPC.SendToChat"}}"><i class="fa-solid fa-fw fa-comment-alt"></i></a>
                                        {{#if @root.options.editable}}
                                            <a class="item-control item-edit" title="{{localize "PF2E.EditItemTitle"}}"><i class="fa-solid fa-fw fa-edit"></i></a>
                                            <a class="item-control item-delete" title="{{localize "PF2E.DeleteItemTitle"}}"><i class="fa-solid fa-fw fa-trash"></i></a>
                                        {{/if}}
                                    </div>
                                </li>
                            {{/each}}
                        </ol>
                </fieldset>
                {{/if}}

                {{!-- ============== --}}
                {{!--     Tactics    --}}
                {{!-- ============== --}}
                <fieldset>
                    <legend class="compendium-items"><i class="fa-light fa-flag-swallowtail"></i>&nbsp;Tactics</legend>
                        <ol class="item-list">
                        {{#if document.itemTypes.feat}}
                            {{#each document.itemTypes.feat as |feat|}}
                                <li class="item" data-item-id="{{feat._id}}">
                                    <a class="item-icon item-chat">
                                        <i class="imgicon fa-solid fa-fw fa-comment-alt"></i>
                                        <img class="item-icon" src="{{feat.img}}" alt="{{feat.name}}" />
                                    </a>
                                    <label class="item-name">
                                        <a>{{feat.name}}</a>
                                    </label>                                    </label>
                                        {{#if feat.system.frequency}}
                                            <section class="item-frequency">
                                                <input type="number" value="{{feat.system.frequency.value}}" data-item-id="{{feat._id}}" data-item-property="system.frequency.value"/>
                                                <span>
                                                    /
                                                    {{feat.system.frequency.max}}
                                                    {{localize "PF2E.Frequency.per"}}
                                                    {{localize (lookup @root.frequencies feat.system.frequency.per)}}
                                                </span>
                                            </section>
                                        {{/if}}
                                    <div class="item-controls">
                                            <a class="item-chat chat" title="{{localize "PF2E.NPC.SendToChat"}}"><i class="fa-solid fa-fw fa-comment-alt"></i></a>
                                        {{#if @root.options.editable}}
                                            <a class="item-control item-edit" title="{{localize "PF2E.EditItemTitle"}}"><i class="fa-solid fa-fw fa-edit"></i></a>
                                            <a class="item-control item-delete" title="{{localize "PF2E.DeleteItemTitle"}}"><i class="fa-solid fa-fw fa-trash"></i></a>
                                        {{/if}}
                                    </div>
                                </li>
                            {{/each}}
                        </ol>
                    {{else}}
                    <p class="placeholder"><em>Drag initial tactics here!</em></p>
                    {{/if}}
                </fieldset>

                {{!-- ============== --}}
                {{!--     Effects    --}}
                {{!-- ============== --}}
                {{#if document.itemTypes.effect}}
                    <fieldset>
                        <legend class="compendium-items"><i class="fa-light fa-sparkles"></i>&nbsp;Conditions</legend>
                        <ol class="item-list">
                            {{#each document.itemTypes.effect as |effect|}}
                                <li class="item" data-item-id="{{effect._id}}">
                                    <a class="item-icon item-chat">
                                        <i class="imgicon fa-solid fa-fw fa-comment-alt"></i>
                                        <img class="item-icon" src="{{effect.img}}" alt="{{effect.name}}" />
                                    </a>
                                    <label class="item-name">
                                        <a>{{effect.name}}</a>
                                    </label>
                                        {{#if (and (eq effect.type "effect") (eq effect.badge.type "counter"))}}
                                            ({{coalesce effect.badge.label effect.badge.value}})
                                        {{/if}}
                                        {{#if (eq effect.type "condition")}}{{#unless effect.active}}<span> (Inactive)</span>{{/unless}}{{/if}}
                                    <div class="item-controls">
                                        {{#if (and @root.options.editable (not effect.readonly))}}
                                            {{#if (eq effect.badge.type "counter")}}
                                                <a class="item-control increment" title="{{localize "PF2E.IncrementEffectTitle"}}"><i class="fa-solid fa-fw fa-plus"></i></a>
                                                <a class="item-control decrement" title="{{localize "PF2E.DecrementEffectTitle"}}"><i class="fa-solid fa-fw fa-minus"></i></a>
                                            {{/if}}
                                            <a class="item-chat chat" title="{{localize "PF2E.NPC.SendToChat"}}"><i class="fa-solid fa-fw fa-comment-alt"></i></a>
                                            {{#if (eq effect.type "effect")}}
                                                <a class="item-control item-edit" title="{{localize "PF2E.EditItemTitle"}}"><i class="fa-solid fa-fw fa-edit"></i></a>
                                            {{/if}}
                                            <a class="item-control item-delete" title="{{localize "PF2E.DeleteItemTitle"}}"><i class="fa-solid fa-fw fa-trash"></i></a>
                                        {{else if effect.readonly}}
                                            <a class="item-control info-only" title="{{effect.breakdown}}"><i class="fa-solid fa-fw fa-info-circle"></i></a>
                                        {{/if}}
                                    </div>
                                </li>
                            {{/each}}
                        </ol>
                    </fieldset>
                {{/if}}

                {{!-- ============== --}}
                {{!--      Desc      --}}
                {{!-- ============== --}}
                
                <fieldset>
                    <legend><i class="fa-light fa-pencil"></i>&nbsp;Description</legend>
                    {{editor data.details.description target="system.details.description" button=true owner=owner editable=editable placeholder="A description of this army!"}}
                </fieldset>

        </section>
    </section>
</form>
